<!DOCTYPE html>
<html>
	<head>
		<title>Amber AI Intent and Entities Input</title>
		<link
			href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css"
			rel="stylesheet"
		/>
	</head>
	<body>
		<div class="container mt-5">
			<h1>AI Intent and Entities Input</h1>
			<form id="aiForm">
				<div class="mb-3">
					<label for="utterance" class="form-label">Utterance</label>
					<input
						type="text"
						class="form-control"
						id="utterance"
						placeholder="Enter utterance"
					/>
				</div>
				<div class="mb-3">
					<label class="form-label">Response</label>
					<div style="margin-left: 20px">
						<label for="responseType" class="form-label">Type</label>
						<select class="form-select" id="responseType">
							<option value="message">Message</option>
						</select>
						<label for="responseContent" class="form-label">Content</label>
						<input
							type="text"
							class="form-control"
							id="responseContent"
							placeholder="Enter response content"
						/>
					</div>
				</div>
				<div class="mb-3">
					<label for="speaker" class="form-label">Speaker</label>
					<select class="form-select" id="speaker">
						<option value="system">System</option>
						<option value="user">User</option>
						<option value="bot">Bot</option>
					</select>
				</div>

				<div class="mb-3">
					<label class="form-label">Actions</label>
					<div id="actionContainer" style="margin-left: 20px">
						<!-- Action fields will be appended here -->
					</div>
					<button type="button" class="btn btn-secondary" onclick="addAction()">
						Add Action
					</button>
					<button type="button" class="btn btn-danger" onclick="removeAction()">
						Remove Last Action
					</button>
				</div>

				<div class="mb-3">
					<label for="plugin" class="form-label">Plugin</label>
					<input type="checkbox" class="form-check-input" id="plugin" />
				</div>
				<div class="mb-3">
					<label for="newMood" class="form-label">New Mood</label>
					<input
						type="text"
						class="form-control"
						id="newMood"
						placeholder="Enter new mood"
					/>
				</div>
				<div class="mb-3">
					<label for="intent" class="form-label">Intent</label>
					<select class="form-select" id="intent" onchange="updateEntities()">
						<!-- Intent options will be dynamically populated here -->
					</select>
				</div>

				<div class="mb-3">
					<label class="form-label">Entities</label>
					<div id="entityContainer" style="margin-left: 20px">
						<!-- Entity fields will be appended here -->
					</div>
					<button type="button" class="btn btn-secondary" onclick="addEntity()">
						Add Entity
					</button>
					<button type="button" class="btn btn-danger" onclick="removeEntity()">
						Remove Last Entity
					</button>
				</div>
				<button type="button" class="btn btn-secondary" id="addToList">
					Add to List
				</button>
				<ul id="turnList">
					<!-- Conversational turns will be appended here -->
				</ul>
				<button type="button" class="btn btn-success" id="submitToServer">
					Submit to Server
				</button>
			</form>
		</div>
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.bundle.min.js"></script>
		<script>
			// Array of intents
			// Object mapping intents to their respective entities
			const intentEntities = {
				configureTheme: ["themeName"],
				pluginInstall: ["pluginName"],
				pluginUninstall: ["pluginName"],
				pluginInit: ["pluginName"],
				GoveeTurnOn: ["deviceName"],
				GoveeTurnOff: ["deviceName"],
				GoveeSetBrightness: ["deviceName", "brightnessLevel"],
				GoveeSetColor: ["deviceName", "color"],
			};

			// Populate the intent dropdown
			const intentDropdown = document.getElementById("intent");
			Object.keys(intentEntities).forEach((intent) => {
				const option = document.createElement("option");
				option.value = intent;
				option.text = intent;
				intentDropdown.appendChild(option);
			});

			// Function to update entity fields based on selected intent
			function updateEntities() {
				const selectedIntent = document.getElementById("intent").value;
				const entities = intentEntities[selectedIntent] || [];
				const entityContainer = document.getElementById("entityContainer");

				// Clear existing entity fields
				entityContainer.innerHTML = "";

				// Add new entity fields based on selected intent
				entities.forEach((entity) => {
					const entityDiv = document.createElement("div");
					entityDiv.className = "mb-3 entity-field";
					entityDiv.innerHTML = `
      <label for="entityName" class="form-label">Entity Name</label>
      <input type="text" class="form-control" value="${entity}" readonly>
      <label for="entityValue" class="form-label">Entity Value</label>
      <input type="text" class="form-control" placeholder="Enter entity value">
    `;
					entityContainer.appendChild(entityDiv);
				});
			}

			// Add event listener to intent dropdown
			document
				.getElementById("intent")
				.addEventListener("change", updateEntities);

			// Initialize entities for the default intent
			updateEntities();

			function addEntity() {
				const entityDiv = document.createElement("div");
				entityDiv.className = "mb-3 entity-field";
				entityDiv.innerHTML = `
        <label for="entityName" class="form-label">Entity Name</label>
        <input type="text" class="form-control" placeholder="Enter entity name">
        <label for="entityValue" class="form-label">Entity Value</label>
        <input type="text" class="form-control" placeholder="Enter entity value">
      `;
				document.getElementById("entityContainer").appendChild(entityDiv);
			}

			function removeEntity() {
				const entityContainer = document.getElementById("entityContainer");
				const entities = entityContainer.getElementsByClassName("entity-field");
				if (entities.length > 0) {
					entityContainer.removeChild(entities[entities.length - 1]);
				}
			}

			function addAction() {
				const actionDiv = document.createElement("div");
				actionDiv.className = "mb-3 action-field";
				actionDiv.innerHTML = `
    <select class="form-select" placeholder="Select action type">
      <option value="prompt">Prompt</option>
      <option value="intent">Intent</option>
    </select>
  `;
				document.getElementById("actionContainer").appendChild(actionDiv);
			}

			function removeAction() {
				const actionContainer = document.getElementById("actionContainer");
				const actions = actionContainer.getElementsByClassName("action-field");
				if (actions.length > 0) {
					actionContainer.removeChild(actions[actions.length - 1]);
				}
			}
			const turnList = [];

			// Function to add conversational turn to list
			function addToList() {
				const turnData = {
					speaker: document.getElementById("speaker").value,
					utterance: document.getElementById("utterance").value,
					response: {
						type: document.getElementById("responseType").value,
						content: document.getElementById("responseContent").value,
					},
					action: Array.from(
						document.querySelectorAll(".action-field select")
					).map((select) => ({
						type: select.value,
					})),
					plugin: document.getElementById("plugin").checked,
					newMood: document.getElementById("newMood").value,
					intent: document.getElementById("intent").value,
					entities: Array.from(document.querySelectorAll(".entity-field")).map(
						(div) => ({
							name: div.querySelector('input[type="text"]').value,
							value: div.querySelector('input[type="text"]:nth-child(2)').value,
						})
					),
				};

				turnList.push(turnData);

				const listItem = document.createElement("li");
				listItem.textContent = `${turnData.speaker}: ${turnData.utterance}`;

				const removeButton = document.createElement("button");
				removeButton.textContent = "Remove";
				removeButton.addEventListener("click", function () {
					const index = turnList.indexOf(turnData);
					if (index > -1) {
						turnList.splice(index, 1);
						listItem.remove();
					}
				});

				listItem.appendChild(removeButton);
				document.getElementById("turnList").appendChild(listItem);
			}

			// Function to send the entire list to the server
			function submitToServer() {
				fetch("/submit-training", {
					method: "POST",
					headers: {
						"Content-Type": "application/json",
					},
					body: JSON.stringify(turnList),
				})
					.then((response) => response.json())
					.then((data) => {
						console.log("Success:", data);
					})
					.catch((error) => {
						console.error("Error:", error);
					});
			}

			// Add event listeners
			document.getElementById("addToList").addEventListener("click", addToList);
			document
				.getElementById("submitToServer")
				.addEventListener("click", submitToServer);
		</script>
	</body>
</html>
